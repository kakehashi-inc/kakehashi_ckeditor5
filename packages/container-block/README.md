# Container Block Plugin

CKEditor 5にリサイズ可能なコンテナブロックを追加するプラグインです。

## 主な機能

- ドラッグによる自由なリサイズ（10%〜100%、1%単位）
- プリセットサイズの選択（100%, 75%, 50%, 25%）
- 位置調整（左、中央、右）
- 前後に段落を追加するボタン
- すべてのCKEditorブロックをコンテナ内に配置可能
- 外部CSS不要のクリーンなHTML出力
- 日本語入力（IME）に完全対応

## 機能詳細

### リサイズ機能

- **ドラッグリサイズ**：コンテナ右端のハンドルをドラッグして10%〜100%の範囲で自由にリサイズ
- **1%単位での細かな調整**：ドラッグ中は1%刻みで調整可能
- **リアルタイム表示更新**：埋め込みツールバーの幅表示がリアルタイムで更新

### プリセットサイズ

埋め込みツールバーから以下のサイズをワンクリックで設定可能：

- **100%**（フル幅）
- **75%**（3/4幅）
- **50%**（半分幅）
- **25%**（1/4幅）

### 位置調整

埋め込みツールバーの矢印ボタンで位置を調整：

- **← 左寄せ**：`margin-right: auto; margin-left: 0;`
- **↔ 中央配置**：`margin-left: auto; margin-right: auto;`
- **→ 右寄せ**：`margin-left: auto; margin-right: 0;`

### 段落追加機能

コンテナの前後に段落を簡単に追加：

- **前に段落を追加**：コンテナの直前に新しい段落を挿入し、カーソルを移動
- **後に段落を追加**：コンテナの直後に新しい段落を挿入し、カーソルを移動

この機能により、コンテナの前後に簡単にテキストを追加できます。

## 使用方法

### コンテナの作成

1. エディタ内で任意の位置にカーソルを置く
2. ツールバーの「コンテナブロック」ボタン（四角いアイコン）をクリック
3. コンテナが作成され、上部に統合ツールバーが表示される

### サイズと位置の調整

コンテナにはCKEditor標準の画像ウィジェットと同様の、常時表示される統合ツールバーが埋め込まれています：

```
┌───────────────────────────────────────────────────────┐
│  幅: 100%  | 25% 50% 75% 100% | ← ↔ → | ↑ ↓          │  ← 埋め込みツールバー
├───────────────────────────────────────────────────────┤
│                                                        │
│  コンテンツエリア                                       │
│                                                        │
└───────────────────────────────────────────────────────┘
```

- **幅表示**：現在の幅をパーセンテージで表示
- **プリセットサイズ**：25%, 50%, 75%, 100%のボタン
- **位置調整**：←（左寄せ）、↔（中央）、→（右寄せ）
- **段落追加**：↑（前に追加）、↓（後に追加）

### リサイズハンドルでの調整

- コンテナの右端にマウスをホバーするとリサイズハンドルが表示される
- ドラッグして任意のサイズに調整（10%〜100%、1%刻み）
- リアルタイムで埋め込みツールバーの幅表示が更新される

### コンテンツの編集

- コンテナ内で通常通りテキスト編集が可能
- 段落、見出し、画像、表、リストなど、すべてのブロック要素を配置可能
- 日本語入力（IME）も正常に動作
- コンテナ内にはパディングなし（純粋なサイズ制御）

### フォーカス管理

- コンテナ内をクリック：通常通り編集可能
- 埋め込みツールバーは常時表示
- ホバー時にリサイズハンドルと視覚的フィードバックが表示

## HTML出力

コンテナブロックは以下のようなクリーンなHTMLを出力します：

```html
<div class="container-block" style="width: 75%; margin-left: auto; margin-right: auto;">
    <p>コンテンツ1</p>
    <p>コンテンツ2</p>
</div>
```

**特徴：**
- 外部CSSに依存しない
- インラインスタイルで完結
- どこでも正しく表示される
- パディングなしの純粋なサイズ制御

## ファイル構成

```
packages/container-block/
├── README.md                                    # このファイル
├── src/
│   ├── containerblock.js                        # メインプラグインファイル
│   ├── containerblock/
│   │   ├── constants.js                         # 定数定義
│   │   ├── containerblockcommand.js             # コマンド実装
│   │   ├── containerblockediting.js             # エディティングロジック
│   │   ├── containerblockui.js                  # UI実装
│   │   └── containerblockresizer.js             # リサイズ機能
└── theme/
    ├── containerblock.css                       # スタイルシート
    └── icons/
        └── container-block.svg                  # アイコン
```

## 技術仕様

### スキーマ定義

```javascript
schema.register('containerBlock', {
    isObject: false,      // 通常の編集を許可（IME対応）
    isLimit: false,       // 制限なし（IME対応）
    isBlock: true,        // ブロック要素
    allowWhere: '$block', // ブロック要素が配置できる場所に配置可能
    allowContentOf: '$root', // ルート要素と同じコンテンツを許可
    allowAttributes: ['width', 'alignment'] // 幅と位置の属性
});
```

### 属性

- **width**：コンテナの幅（10〜100のパーセント値）
- **alignment**：位置調整（'left', 'center', 'right'）

### UI構造

埋め込みツールバーはコンテナの上部に直接統合され、以下の機能を提供：

- **幅設定**：プリセットボタンまたはドラッグリサイズ
- **位置調整**：左寄せ、中央、右寄せボタン
- **段落追加**：前または後に段落を挿入
